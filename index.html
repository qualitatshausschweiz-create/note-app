<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notizen Premium</title>

<style>
:root {
  --accent: #007aff;
  --accent-light: #4da3ff;
  --accent-glow: rgba(0,122,255,0.35);
  --app-font: -apple-system, system-ui, sans-serif;
  --text-size: 16px;
  --blur-amount: 18px;
}

body {
  margin: 0;
  font-family: var(--app-font);
  font-size: var(--text-size);
  background: #f2f2f7;
  color: #111;
  transition: background 0.3s, color 0.3s;
}

body.dark {
  background: #1c1c1e;
  color: #fff;
}

body.amoled {
  background: #000;
  color: #fff;
}

/* PIN OVERLAY */
#pinOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(12px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

#pinBox {
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(20px);
  padding: 28px;
  border-radius: 22px;
  width: 280px;
  text-align: center;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
}

#pinTitle {
  font-size: 22px;
  margin-bottom: 18px;
  font-weight: 600;
}

#pinCircles {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 22px;
}

.pinCircle {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid var(--accent);
  transition: 0.2s;
}

.pinCircle.filled {
  background: var(--accent);
  box-shadow: 0 0 10px var(--accent-glow);
}

#pinPad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 14px;
}

.pinKey {
  padding: 16px;
  font-size: 20px;
  border-radius: 14px;
  border: none;
  background: #e5e5ea;
  transition: 0.15s;
}

.pinKey:active {
  background: var(--accent-light);
  color: #fff;
  box-shadow: 0 0 12px var(--accent-glow);
}

.pinKey.backspace {
  background: #ff3b30;
  color: #fff;
}

#pinError {
  margin-top: 12px;
  color: red;
  opacity: 0;
  transition: opacity 0.3s;
}

/* HEADER */
header {
  display: flex;
  justify-content: space-between;
  padding: 15px;
  font-size: 22px;
  font-weight: bold;
}

.iconBtn {
  background: none;
  border: none;
  font-size: 24px;
  margin-left: 10px;
}

/* CATEGORIE */
#categories {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding: 10px;
}

.cat {
  padding: 8px 16px;
  background: #e5e5ea;
  border-radius: 14px;
  white-space: nowrap;
  font-size: 15px;
}

/* NOTE LIST */
#notesList {
  padding: 15px;
}

.noteItem {
  background: #fff;
  padding: 16px;
  margin-bottom: 14px;
  border-radius: 14px;
  border-left: 5px solid var(--accent);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

/* ADD BUTTON */
#addNoteBtn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  border: none;
  background: var(--accent);
  color: #fff;
  font-size: 36px;
  box-shadow: 0 6px 20px var(--accent-glow);
}

/* EDITOR */
#noteEditor {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  display: none;
  justify-content: center;
  align-items: center;
}

#noteEditorBox {
  background: #fff;
  width: 90%;
  max-width: 420px;
  padding: 22px;
  border-radius: 20px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
}

#noteText {
  width: 100%;
  height: 160px;
  margin-top: 12px;
  padding: 12px;
  border-radius: 14px;
  border: 1px solid #ccc;
  font-size: 16px;
}

#editorButtons {
  display: flex;
  justify-content: space-between;
  margin-top: 18px;
}

/* POPUP GENERICI */
.popupBox {
  background: #fff;
  padding: 22px;
  border-radius: 20px;
  width: 85%;
  max-width: 380px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
}

#archivePopup,
#infoPopup,
#resetPopup {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
}

/* SETTINGS PANEL */
#settingsPanel {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: flex-end;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(5px);
}

#settingsSheet {
  width: 80%;
  max-width: 350px;
  background: #fff;
  height: 100%;
  padding: 22px;
  border-radius: 20px 0 0 20px;
  transform: translateX(100%);
  transition: transform 0.3s;
}

#settingsPanel.show #settingsSheet {
  transform: translateX(0);
}

.settingsItem {
  width: 100%;
  padding: 14px;
  margin-bottom: 10px;
  background: #e5e5ea;
  border-radius: 14px;
  border: none;
  text-align: left;
  font-size: 16px;
}

.settingsClose {
  margin-top: 20px;
  width: 100%;
  padding: 14px;
  background: var(--accent);
  color: #fff;
  border-radius: 14px;
  border: none;
}

/* BANNER */
#bannerMsg {
  position: fixed;
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--accent);
  color: #fff;
  padding: 10px 20px;
  border-radius: 14px;
  opacity: 0;
  transition: opacity 0.3s;
}

#bannerMsg.show {
  opacity: 1;
}
</style>
</head>

<body>

<!-- PIN OVERLAY -->
<div id="pinOverlay">
  <div id="pinBox">
    <div id="pinTitle">Inserisci PIN</div>

    <div id="pinCircles">
      <div class="pinCircle"></div>
      <div class="pinCircle"></div>
      <div class="pinCircle"></div>
      <div class="pinCircle"></div>
    </div>

    <div id="pinPad">
      <button class="pinKey" data-digit="1">1</button>
      <button class="pinKey" data-digit="2">2</button>
      <button class="pinKey" data-digit="3">3</button>

      <button class="pinKey" data-digit="4">4</button>
      <button class="pinKey" data-digit="5">5</button>
      <button class="pinKey" data-digit="6">6</button>

      <button class="pinKey" data-digit="7">7</button>
      <button class="pinKey" data-digit="8">8</button>
      <button class="pinKey" data-digit="9">9</button>

      <button class="pinKey empty"></button>
      <button class="pinKey" data-digit="0">0</button>
      <button class="pinKey backspace" id="pinBackspace">‚å´</button>
    </div>

    <div id="pinError"></div>
  </div>
</div>

<!-- APP -->
<div id="app">

  <div id="bannerMsg"></div>

  <header>
    <div id="appTitle">Notizen</div>
    <div>
      <button id="themeBtn" class="iconBtn">üåô</button>
      <button id="langBtn" class="iconBtn">üåê</button>
      <button id="backupBtn" class="iconBtn">üõü</button>
      <button id="settingsBtn" class="iconBtn">‚öôÔ∏è</button>
    </div>
  </header>

  <div id="categories">
    <div class="cat" data-cat="favorite">Favoriten</div>
    <div class="cat" data-cat="alle">Alle</div>
    <div class="cat" data-cat="arbeit">Arbeit</div>
    <div class="cat" data-cat="einkauf">Einkauf</div>
    <div class="cat" data-cat="zuhause">Zuhause</div>
    <div class="cat" data-cat="ideen">Ideen</div>
    <div class="cat" data-cat="personlich">Pers√∂nlich</div>
  </div>

  <div id="notesList"></div>

  <button id="addNoteBtn">+</button>

</div>

<!-- EDITOR -->
<div id="noteEditor">
  <div id="noteEditorBox">

    <button id="deleteNoteBtn">üóë</button>

    <h2 id="editorTitle">Neue Notiz</h2>

    <textarea id="noteText"></textarea>

    <div id="editorButtons">
      <button id="cancelBtn">Abbrechen</button>
      <button id="saveBtn">Speichern</button>
    </div>

  </div>
</div>

<!-- POPUP + SETTINGS (STUB COMPLETI, MA SEMPLIFICATI) -->
<div id="archivePopup">
  <div class="popupBox">
    <h2>Archivio</h2>
    <div id="archiveList"></div>
    <button id="archiveCloseBtn" class="popupBtn">Chiudi</button>
  </div>
</div>

<div id="infoPopup">
  <div class="popupBox">
    <h2>Info App</h2>
    <p>Versione: 2.0 Premium</p>
    <p>Autore: Sandro</p>
    <button id="infoCloseBtn" class="popupBtn">Chiudi</button>
  </div>
</div>

<div id="resetPopup">
  <div class="popupBox">
    <h2>Reset App</h2>
    <p>Questa azione canceller√† tutte le note e le impostazioni.</p>
    <button id="resetConfirmBtn" class="popupBtn">Conferma</button>
    <button id="resetCancelBtn" class="popupBtn">Annulla</button>
  </div>
</div>

<div id="settingsPanel">
  <div id="settingsSheet">

    <div class="settingsTitle">Impostazioni</div>

    <div class="settingsSection">Aspetto</div>
    <button class="settingsItem" id="settingsTheme">Tema (Chiaro/Scuro)</button>
    <button class="settingsItem" id="settingsAmoled">Tema AMOLED</button>

    <div class="settingsSection">Sicurezza</div>
    <button class="settingsItem" id="settingsChangePin">Cambia PIN</button>
    <button class="settingsItem" id="settingsTimeout">Timeout PIN</button>

    <div class="settingsSection">Sistema</div>
    <button class="settingsItem" id="settingsResetApp">Reset App</button>
    <button class="settingsItem" id="settingsInfo">Info App</button>

    <button class="settingsClose">Chiudi</button>

  </div>
</div>

<script>
/* STORAGE KEYS */
const STORAGE_NOTES_KEY = "notes_v1";
const STORAGE_PIN_KEY = "pin_v1";
const STORAGE_TIMEOUT_KEY = "timeout_v1";
const STORAGE_THEME_KEY = "theme_v1";
const STORAGE_AMOLED_KEY = "amoled_v1";

const DEFAULT_PIN = "4618";

/* DOM */
const pinOverlay = document.getElementById("pinOverlay");
const pinCircles = Array.from(document.querySelectorAll(".pinCircle"));
const pinKeys = Array.from(document.querySelectorAll(".pinKey"));
const pinBackspace = document.getElementById("pinBackspace");
const pinError = document.getElementById("pinError");

const notesList = document.getElementById("notesList");
const addNoteBtn = document.getElementById("addNoteBtn");
const noteEditor = document.getElementById("noteEditor");
const editorTitle = document.getElementById("editorTitle");
const noteText = document.getElementById("noteText");
const deleteNoteBtn = document.getElementById("deleteNoteBtn");
const cancelBtn = document.getElementById("cancelBtn");
const saveBtn = document.getElementById("saveBtn");

const themeBtn = document.getElementById("themeBtn");
const settingsBtn = document.getElementById("settingsBtn");
const settingsPanel = document.getElementById("settingsPanel");
const settingsSheet = document.getElementById("settingsSheet");
const settingsClose = document.querySelector(".settingsClose");
const settingsTheme = document.getElementById("settingsTheme");
const settingsAmoled = document.getElementById("settingsAmoled");
const settingsChangePin = document.getElementById("settingsChangePin");
const settingsTimeout = document.getElementById("settingsTimeout");
const settingsResetApp = document.getElementById("settingsResetApp");
const settingsInfo = document.getElementById("settingsInfo");

const archivePopup = document.getElementById("archivePopup");
const archiveCloseBtn = document.getElementById("archiveCloseBtn");
const infoPopup = document.getElementById("infoPopup");
const infoCloseBtn = document.getElementById("infoCloseBtn");
const resetPopup = document.getElementById("resetPopup");
const resetConfirmBtn = document.getElementById("resetConfirmBtn");
const resetCancelBtn = document.getElementById("resetCancelBtn");
const bannerMsg = document.getElementById("bannerMsg");

/* STATE */
let notes = [];
let editingIndex = null;
let currentPinInput = "";
let pinTimeoutMinutes = 5;
let lastUnlockTime = null;

/* PIN LOGIC */
function getStoredPin() {
  return localStorage.getItem(STORAGE_PIN_KEY) || DEFAULT_PIN;
}

function setStoredPin(pin) {
  localStorage.setItem(STORAGE_PIN_KEY, pin);
}

function resetPinInput() {
  currentPinInput = "";
  pinCircles.forEach(c => c.classList.remove("filled"));
}

function updatePinCircles() {
  pinCircles.forEach((c, i) => {
    c.classList.toggle("filled", i < currentPinInput.length);
  });
}

function showPinError(msg) {
  pinError.textContent = msg;
  pinError.style.opacity = 1;
  setTimeout(() => pinError.style.opacity = 0, 1500);
}

function unlockApp() {
  pinOverlay.style.display = "none";
  resetPinInput();
  lastUnlockTime = Date.now();
  localStorage.setItem(STORAGE_TIMEOUT_KEY, String(lastUnlockTime));
}

function handlePinDigit(d) {
  if (currentPinInput.length >= 4) return;

  currentPinInput += d;
  updatePinCircles();

  if (currentPinInput.length === 4) {
    const storedPin = getStoredPin();
    if (currentPinInput === storedPin) {
      unlockApp();
    } else {
      showPinError("PIN errato");
      setTimeout(() => resetPinInput(), 400);
    }
  }
}

function handlePinBackspace() {
  if (!currentPinInput.length) return;
  currentPinInput = currentPinInput.slice(0, -1);
  updatePinCircles();
}

/* EVENTI PIN */
pinKeys.forEach(k => {
  if (k.classList.contains("empty")) return;
  if (k.classList.contains("backspace")) return;
  k.addEventListener("click", () => handlePinDigit(k.dataset.digit));
});

pinBackspace.addEventListener("click", handlePinBackspace);

/* TIMEOUT PIN (SEMPLIFICATO) */
function checkPinTimeout() {
  const last = parseInt(localStorage.getItem(STORAGE_TIMEOUT_KEY) || "0", 10);
  if (!last) {
    pinOverlay.style.display = "flex";
    return;
  }
  const diffMin = (Date.now() - last) / 60000;
  if (diffMin > pinTimeoutMinutes) {
    pinOverlay.style.display = "flex";
  } else {
    pinOverlay.style.display = "none";
  }
}

/* NOTE BASE */
function loadNotes() {
  try {
    const raw = localStorage.getItem(STORAGE_NOTES_KEY);
    notes = raw ? JSON.parse(raw) : [];
  } catch {
    notes = [];
  }
}

function saveNotes() {
  localStorage.setItem(STORAGE_NOTES_KEY, JSON.stringify(notes));
}

function renderNotes() {
  notesList.innerHTML = "";
  notes.forEach((n, i) => {
    const div = document.createElement("div");
    div.className = "noteItem";
    div.textContent = n.text || "";
    div.addEventListener("click", () => openEditor(i));
    notesList.appendChild(div);
  });
}

function openEditor(index = null) {
  editingIndex = index;
  if (index === null) {
    editorTitle.textContent = "Neue Notiz";
    noteText.value = "";
  } else {
    editorTitle.textContent = "Notiz bearbeiten";
    noteText.value = notes[index].text;
  }
  noteEditor.style.display = "flex";
}

function closeEditor() {
  noteEditor.style.display = "none";
  editingIndex = null;
}

addNoteBtn.addEventListener("click", () => openEditor(null));
cancelBtn.addEventListener("click", closeEditor);

saveBtn.addEventListener("click", () => {
  const text = noteText.value.trim();
  if (!text) {
    closeEditor();
    return;
  }
  if (editingIndex === null) {
    notes.unshift({ text });
  } else {
    notes[editingIndex].text = text;
  }
  saveNotes();
  renderNotes();
  closeEditor();
});

deleteNoteBtn.addEventListener("click", () => {
  if (editingIndex === null) {
    closeEditor();
    return;
  }
  notes.splice(editingIndex, 1);
  saveNotes();
  renderNotes();
  closeEditor();
});

/* THEME */
function applyTheme() {
  const theme = localStorage.getItem(STORAGE_THEME_KEY) || "light";
  const amoled = localStorage.getItem(STORAGE_AMOLED_KEY) === "1";
  document.body.classList.toggle("dark", theme === "dark");
  document.body.classList.toggle("amoled", amoled);
}

themeBtn.addEventListener("click", () => {
  const current = localStorage.getItem(STORAGE_THEME_KEY) || "light";
  const next = current === "light" ? "dark" : "light";
  localStorage.setItem(STORAGE_THEME_KEY, next);
  applyTheme();
});

/* SETTINGS PANEL */
settingsBtn.addEventListener("click", () => {
  settingsPanel.style.display = "flex";
  setTimeout(() => settingsPanel.classList.add("show"), 10);
});

settingsClose.addEventListener("click", () => {
  settingsPanel.classList.remove("show");
  setTimeout(() => settingsPanel.style.display = "none", 300);
});

/* SETTINGS ACTIONS (SEMPLIFICATE) */
settingsTheme.addEventListener("click", () => {
  const current = localStorage.getItem(STORAGE_THEME_KEY) || "light";
  const next = current === "light" ? "dark" : "light";
  localStorage.setItem(STORAGE_THEME_KEY, next);
  applyTheme();
  showBanner("Tema cambiato");
});

settingsAmoled.addEventListener("click", () => {
  const current = localStorage.getItem(STORAGE_AMOLED_KEY) === "1";
  localStorage.setItem(STORAGE_AMOLED_KEY, current ? "0" : "1");
  applyTheme();
  showBanner("AMOLED toggled");
});

settingsChangePin.addEventListener("click", () => {
  const nuovo = prompt("Nuovo PIN (4 cifre):", "");
  if (!nuovo || nuovo.length !== 4 || !/^[0-9]{4}$/.test(nuovo)) {
    alert("PIN non valido");
    return;
  }
  setStoredPin(nuovo);
  showBanner("PIN cambiato");
});

settingsTimeout.addEventListener("click", () => {
  const val = prompt("Timeout PIN in minuti:", String(pinTimeoutMinutes));
  const num = parseInt(val || "5", 10);
  if (!num || num < 1) return;
  pinTimeoutMinutes = num;
  showBanner("Timeout aggiornato");
});

settingsResetApp.addEventListener("click", () => {
  resetPopup.style.display = "flex";
});

settingsInfo.addEventListener("click", () => {
  infoPopup.style.display = "flex";
});

infoCloseBtn.addEventListener("click", () => {
  infoPopup.style.display = "none";
});

resetCancelBtn.addEventListener("click", () => {
  resetPopup.style.display = "none";
});

resetConfirmBtn.addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});

/* BANNER */
function showBanner(msg) {
  bannerMsg.textContent = msg;
  bannerMsg.classList.add("show");
  setTimeout(() => bannerMsg.classList.remove("show"), 1500);
}

/* INIT */
function init() {
  applyTheme();
  loadNotes();
  renderNotes();
  checkPinTimeout();
}

init();
</script>
</body>
</html>
