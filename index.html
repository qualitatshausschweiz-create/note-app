<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Notizen</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #f2f2f7;
  color: #000;
}
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  background: #fff;
  border-bottom: 1px solid #ccc;
}
#categoryBar {
  display: flex;
  overflow-x: auto;
  padding: 10px;
  background: #fff;
  border-bottom: 1px solid #ccc;
}
.categoryBtn {
  padding: 8px 14px;
  margin-right: 8px;
  border-radius: 12px;
  border: none;
  background: #e5e5ea;
  cursor: pointer;
}
.categoryBtn.active {
  background: #007aff;
  color: white;
}
#notesList {
  padding: 15px;
}
.noteItem {
  background: white;
  padding: 14px;
  border-radius: 12px;
  margin-bottom: 12px;
  border: 1px solid #ddd;
}
#editorPopup, #backupPopup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.45);
  display: none;
  justify-content: center;
  align-items: center;
}
.popupContent {
  background: white;
  padding: 20px;
  width: 90%;
  max-width: 420px;
  border-radius: 16px;
}
.actionBtn {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <div id="title">Notizen</div>
  <button onclick="openBackupPopup()">Sicherung</button>
</header>

<div id="categoryBar"></div>
<div id="notesList"></div>

<!-- BACKUP POPUP -->
<div id="backupPopup">
  <div class="popupContent">
    <h2 id="backupTitle">Sicherung</h2>

    <button id="backupExportBtn" class="actionBtn" style="background:#34c759; color:white;" onclick="exportBackup()">
      Exportieren
    </button>

    <button id="backupImportBtn" class="actionBtn" style="background:#007aff; color:white;" onclick="document.getElementById('backupFile').click()">
      Importieren
    </button>

    <button id="backupAutoRestoreBtn" class="actionBtn" style="background:#ff9500; color:white;" onclick="restoreAutoBackup()">
      Automatische Sicherung wiederherstellen
    </button>

    <p id="autoBackupInfo" style="margin-top:15px; font-size:14px; color:#555;">
      Letzte automatische Sicherung: –
    </p>

    <button class="actionBtn" style="background:#ccc;" onclick="closeBackupPopup()">Schließen</button>

    <input type="file" id="backupFile" accept="application/json" style="display:none" onchange="importBackup(event)">
  </div>
</div>
<script>
let currentLang = "de";
let currentCategory = "alle";

const translations = {
  de: {
    backupTitle: "Sicherung",
    backupExport: "Exportieren",
    backupImport: "Importieren",
    backupAutoRestore: "Automatische Sicherung wiederherstellen",
    backupAutoRestored: "Automatische Sicherung erfolgreich wiederhergestellt!",
    backupAutoMissing: "Keine automatische Sicherung gefunden!",
    autoBackupLabel: "Letzte automatische Sicherung:"
  },
  it: {
    backupTitle: "Backup",
    backupExport: "Esporta",
    backupImport: "Importa",
    backupAutoRestore: "Ripristina backup automatico",
    backupAutoRestored: "Backup automatico ripristinato con successo!",
    backupAutoMissing: "Nessun backup automatico trovato!",
    autoBackupLabel: "Ultimo backup automatico:"
  },
  en: {
    backupTitle: "Backup",
    backupExport: "Export",
    backupImport: "Import",
    backupAutoRestore: "Restore automatic backup",
    backupAutoRestored: "Automatic backup restored successfully!",
    backupAutoMissing: "No automatic backup found!",
    autoBackupLabel: "Last automatic backup:"
  },
  es: {
    backupTitle: "Bécap",
    backupExport: "Exportar",
    backupImport: "Importar",
    backupAutoRestore: "Restaurar bécap automático",
    backupAutoRestored: "¡Bécap automático restaurado correctamente!",
    backupAutoMissing: "¡No se encontró ningún bécap automático!",
    autoBackupLabel: "Último bécap automático:"
  }
};

function applyTranslations() {
  const t = translations[currentLang];
  document.getElementById("backupTitle").textContent = t.backupTitle;
  document.getElementById("backupExportBtn").textContent = t.backupExport;
  document.getElementById("backupImportBtn").textContent = t.backupImport;
  document.getElementById("backupAutoRestoreBtn").textContent = t.backupAutoRestore;

  updateAutoBackupLabel();
}

function openBackupPopup() {
  applyTranslations();
  document.getElementById("backupPopup").style.display = "flex";
}

function closeBackupPopup() {
  document.getElementById("backupPopup").style.display = "none";
}

function exportBackup() {
  const notes = localStorage.getItem("notes") || "[]";
  const blob = new Blob([notes], { type: "application/json" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "backup.json";
  a.click();
}

function importBackup(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    localStorage.setItem("notes", e.target.result);
    showNotes(currentCategory);
  };
  reader.readAsText(file);
}
// TIMESTAMP FORMATO: 2026-01-22 18:05:33
function getTimestamp() {
  const d = new Date();
  const pad = n => (n < 10 ? "0" + n : n);
  return (
    d.getFullYear() + "-" +
    pad(d.getMonth() + 1) + "-" +
    pad(d.getDate()) + " " +
    pad(d.getHours()) + ":" +
    pad(d.getMinutes()) + ":" +
    pad(d.getSeconds())
  );
}

function saveAutoBackup() {
  const notes = localStorage.getItem("notes") || "[]";
  const data = {
    timestamp: getTimestamp(),
    notes: JSON.parse(notes)
  };
  localStorage.setItem("autoBackup", JSON.stringify(data));
  updateAutoBackupLabel();
}

function updateAutoBackupLabel() {
  const t = translations[currentLang];
  const info = document.getElementById("autoBackupInfo");
  const auto = localStorage.getItem("autoBackup");

  if (!auto) {
    info.textContent = t.autoBackupLabel + " –";
    return;
  }

  const parsed = JSON.parse(auto);
  info.textContent = t.autoBackupLabel + " " + parsed.timestamp;
}

function restoreAutoBackup() {
  const auto = localStorage.getItem("autoBackup");
  if (!auto) {
    alert(translations[currentLang].backupAutoMissing);
    return;
  }

  const parsed = JSON.parse(auto);
  localStorage.setItem("notes", JSON.stringify(parsed.notes));

  alert(translations[currentLang].backupAutoRestored);
  showNotes(currentCategory);
}

// NOTE + CATEGORIE (versione abbreviata, identica alla tua)
function showNotes(category) {
  currentCategory = category;
  const notes = JSON.parse(localStorage.getItem("notes") || "[]");
  const list = document.getElementById("notesList");
  list.innerHTML = "";

  notes
    .filter(n => category === "alle" || n.category === category)
    .forEach(n => {
      const div = document.createElement("div");
      div.className = "noteItem";
      div.textContent = n.text;
      list.appendChild(div);
    });
}

// SALVATAGGIO AUTOMATICO AD OGNI MODIFICA
function saveNote(text, category) {
  const notes = JSON.parse(localStorage.getItem("notes") || "[]");
  notes.push({ text, category });
  localStorage.setItem("notes", JSON.stringify(notes));
  saveAutoBackup();
  showNotes(category);
}

function deleteNote(index) {
  const notes = JSON.parse(localStorage.getItem("notes") || "[]");
  notes.splice(index, 1);
  localStorage.setItem("notes", JSON.stringify(notes));
  saveAutoBackup();
  showNotes(currentCategory);
}

showNotes("alle");
applyTranslations();
</script>

</body>
</html>
