<style>
  :root {
    --bg: #f2f2f7;
    --card: #ffffff;
    --text: #000000;

    /* Banner adattivo */
    --banner-bg: rgba(0,0,0,0.85);
    --banner-text: #ffffff;
  }

  body.dark {
    --bg: #000000;
    --card: #1c1c1e;
    --text: #ffffff;

    --banner-bg: rgba(255,255,255,0.85);
    --banner-text: #000000;
  }

  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  #app {
    max-width: 600px;
    margin: 0 auto;
    padding: 16px;
  }

  /* HEADER */
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }
  #appTitle {
    font-size: 24px;
    font-weight: 700;
  }
  .iconBtn {
    border: none;
    background: none;
    font-size: 22px;
    cursor: pointer;
    margin-left: 8px;
    color: var(--text);
  }

  /* BANNER MESSAGGI */
  #bannerMsg {
    position: fixed;
    top: -60px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--banner-bg);
    color: var(--banner-text);
    padding: 10px 18px;
    border-radius: 14px;
    font-size: 15px;
    z-index: 2000;
    opacity: 0;
    transition: all 0.35s ease;
  }
  #bannerMsg.show {
    top: 20px;
    opacity: 1;
  }

  /* CATEGORIE */
  #categories {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    margin-bottom: 12px;
  }
  .cat {
    flex: 0 0 auto;
    padding: 8px 12px;
    border-radius: 16px;
    background: var(--card);
    border: 1px solid #ccc;
    display: flex;
    align-items: center;
    cursor: pointer;
  }
  .catLabel {
    font-size: 14px;
  }

  /* LISTA NOTE */
  #notesList {
    display: block;
  }
  .noteItem {
    background: var(--card);
    border-radius: 14px;
    padding: 12px;
    margin-bottom: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    cursor: pointer;
  }

  /* BOTTONE + */
  #addNoteBtn {
    position: fixed;
    right: 20px;
    bottom: 30px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: none;
    background: #007aff;
    color: #fff;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 1100;
  }

  /* EDITOR NOTE */
  #noteEditor {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.35);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1400;
  }
  #noteEditorBox {
    width: 90%;
    max-width: 500px;
    background: var(--card);
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    gap: 10px;
    position: relative;
  }

  /* ICONA üóë */
  #deleteNoteBtn {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 22px;
    background: none;
    border: none;
    color: var(--text);
    cursor: pointer;
  }

  #noteText {
    width: 100%;
    min-height: 120px;
    border-radius: 12px;
    border: 1px solid #ccc;
    padding: 8px;
    font-size: 16px;
    resize: vertical;
    background: transparent;
    color: inherit;
  }

  #editorButtons {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
  }
  #editorButtons button {
    border-radius: 12px;
    border: none;
    padding: 8px 14px;
    font-size: 15px;
    cursor: pointer;
  }
  #cancelBtn {
    background: #ccc;
    color: #000;
  }
  #saveBtn {
    background: #007aff;
    color: #fff;
  }

  /* COLORI */
  #colorRow {
    display: flex;
    gap: 8px;
    margin-top: 4px;
  }
  .colorDot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
  }
  .colorDot.selected {
    border-color: #000;
  }

  /* POPUP LINGUA + BACKUP */
  #langPopup,
  #backupPopup {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.35);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1500;
  }
  #langBox,
  #backupBox {
    width: 80%;
    max-width: 360px;
    background: var(--card);
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  }

  .langChoice {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 12px;
    border: 1px solid #ccc;
    background: transparent;
    color: inherit;
    font-size: 16px;
    cursor: pointer;
  }

  /* BACKUP */
  .backupBtnRow {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }
  .backupAction {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    color: #000;
  }

  #autoBackupBtn { background: #007aff; color: white; }
  #manualBackupBtn { background: #ffcc00; color: black; }
  #autoRestoreBtn { background: #ff9500; color: white; }
  #manualRestoreBtn { background: #34c759; color: white; }
  #backupCloseBtn { background: #ccc; color: black; }

</style>
<body>
<div id="app">

  <!-- Banner messaggi (nuovo, invisibile finch√© non usato) -->
  <div id="bannerMsg"></div>

  <!-- HEADER -->
  <header>
    <div id="appTitle">Notizen</div>

    <div>
      <button id="langBtn" class="iconBtn">üåê</button>
      <button id="backupBtn" class="iconBtn">üõü</button>
    </div>
  </header>

  <!-- CATEGORIE -->
  <div id="categories">
    <div class="cat" data-cat="favorite"><span class="catLabel">Favoriten</span></div>
    <div class="cat" data-cat="alle"><span class="catLabel">Alle</span></div>
    <div class="cat" data-cat="arbeit"><span class="catLabel">Arbeit</span></div>
    <div class="cat" data-cat="einkauf"><span class="catLabel">Einkauf</span></div>
    <div class="cat" data-cat="zuhause"><span class="catLabel">Zuhause</span></div>
    <div class="cat" data-cat="ideen"><span class="catLabel">Ideen</span></div>
    <div class="cat" data-cat="personlich"><span class="catLabel">Pers√∂nlich</span></div>
  </div>

  <!-- LISTA NOTE -->
  <div id="notesList"></div>

  <!-- BOTTONE + -->
  <button id="addNoteBtn">+</button>

</div>

<!-- ============================
     EDITOR NOTE (identico + icona üóë)
============================ -->
<div id="noteEditor">
  <div id="noteEditorBox">

    <!-- Icona elimina nota (nuova) -->
    <button id="deleteNoteBtn" style="display:none;">üóë</button>

    <h2 id="editorTitle">Neue Notiz</h2>

    <textarea id="noteText"></textarea>

    <!-- Colori -->
    <div id="colorRow">
      <div class="colorDot" data-color="#ffffff" style="background:#ffffff;"></div>
      <div class="colorDot" data-color="#ffeb3b" style="background:#ffeb3b;"></div>
      <div class="colorDot" data-color="#ff9800" style="background:#ff9800;"></div>
      <div class="colorDot" data-color="#4caf50" style="background:#4caf50;"></div>
      <div class="colorDot" data-color="#2196f3" style="background:#2196f3;"></div>
      <div class="colorDot" data-color="#e91e63" style="background:#e91e63;"></div>
    </div>

    <!-- Pulsanti -->
    <div id="editorButtons">
      <button id="cancelBtn">Abbrechen</button>
      <button id="saveBtn">Speichern</button>
    </div>

  </div>
</div>

<!-- ============================
     POPUP LINGUA
============================ -->
<div id="langPopup">
  <div id="langBox">
    <h2>Sprache</h2>
    <button class="langChoice" data-lang="de">Deutsch</button>
    <button class="langChoice" data-lang="it">Italiano</button>
    <button class="langChoice" data-lang="en">English</button>
    <button class="langChoice" data-lang="es">Espa√±ol</button>
  </div>
</div>

<!-- ============================
     POPUP BACKUP
============================ -->
<div id="backupPopup">
  <div id="backupBox">
    <h2>Sicherung</h2>

    <div class="backupBtnRow">
      <button id="autoBackupBtn" class="backupAction"><span>Backup automatisch</span></button>
      <button id="manualBackupBtn" class="backupAction"><span>Backup manuell</span></button>
      <button id="autoRestoreBtn" class="backupAction"><span>Wiederherstellung automatisch</span></button>
      <button id="manualRestoreBtn" class="backupAction"><span>Wiederherstellung manuell</span></button>
      <button id="backupCloseBtn" class="backupAction"><span>Schliessen</span></button>
    </div>

  </div>
</div>
<script>
/* ============================================
   VARIABILI GLOBALI
============================================ */
let notes = [];
let currentNoteId = null;
let currentLang = localStorage.getItem("lang") || "de";

/* ============================================
   BANNER MESSAGGI (nuovo)
============================================ */
function showBanner(msg) {
  const b = document.getElementById("bannerMsg");
  b.textContent = msg;
  b.classList.add("show");

  setTimeout(() => {
    b.classList.remove("show");
  }, 1800);
}

/* ============================================
   BACKUP AUTOMATICO (nuovo)
============================================ */
function autoBackup() {
  localStorage.setItem("notes_backup_auto", JSON.stringify(notes));
}

/* ============================================
   RIPRISTINO AUTOMATICO (nuovo)
============================================ */
function autoRestore() {
  const saved = localStorage.getItem("notes_backup_auto");
  if (saved) {
    notes = JSON.parse(saved);
    saveNotes();
  }
}

/* ============================================
   STORAGE NOTE
============================================ */
function saveNotes() {
  localStorage.setItem("notes", JSON.stringify(notes));
  autoBackup(); // nuovo
}

function loadNotes() {
  return JSON.parse(localStorage.getItem("notes") || "[]");
}

/* ============================================
   MOSTRA NOTE
============================================ */
function showNotes(filter = "alle") {
  const list = document.getElementById("notesList");
  list.innerHTML = "";

  let filtered = notes;

  if (filter === "favorite") {
    filtered = notes.filter(n => n.favorite);
  } else if (filter !== "alle") {
    filtered = notes.filter(n => n.category === filter);
  }

  filtered.forEach(note => {
    const div = document.createElement("div");
    div.className = "noteItem";
    div.style.background = note.color;
    div.innerHTML = `
      <div>${note.text.substring(0, 80)}</div>
      <div style="font-size:18px;margin-top:6px;">${note.favorite ? "‚≠ê" : "‚òÜ"}</div>
    `;
    div.onclick = () => openEditor(note.id);
    list.appendChild(div);
  });
}

/* ============================================
   APRI EDITOR
============================================ */
function openEditor(id = null) {
  currentNoteId = id;

  const editor = document.getElementById("noteEditor");
  const title = document.getElementById("editorTitle");
  const delBtn = document.getElementById("deleteNoteBtn");

  if (id === null) {
    // nuova nota
    title.textContent = LANG[currentLang].newNote;
    document.getElementById("noteText").value = "";
    delBtn.style.display = "none";
  } else {
    // modifica nota
    const note = notes.find(n => n.id === id);
    title.textContent = "Modifica nota"; // multilingua dopo
    document.getElementById("noteText").value = note.text;
    delBtn.style.display = "block";
  }

  editor.style.display = "flex";
}

/* ============================================
   SALVA NOTA
============================================ */
function saveNote() {
  const text = document.getElementById("noteText").value.trim();
  if (!text) {
    closeEditor();
    return;
  }

  if (currentNoteId === null) {
    // nuova nota
    notes.push({
      id: Date.now(),
      text,
      color: "#ffffff",
      category: "alle",
      favorite: false
    });
  } else {
    // modifica nota
    const note = notes.find(n => n.id === currentNoteId);
    note.text = text;
  }

  saveNotes();
  showNotes();
  closeEditor();
}

/* ============================================
   ELIMINA NOTA (nuovo)
============================================ */
function deleteNote() {
  if (!confirm("Sei sicuro?")) return;

  notes = notes.filter(n => n.id !== currentNoteId);
  saveNotes();
  showNotes();
  closeEditor();

  showBanner("Nota eliminata");
}

/* ============================================
   PREFERITI (nuovo messaggio)
============================================ */
function toggleFavorite(id) {
  const note = notes.find(n => n.id === id);
  note.favorite = !note.favorite;

  saveNotes();
  showNotes();

  if (note.favorite) {
    showBanner("Aggiunto ai preferiti");
  } else {
    showBanner("Rimosso dai preferiti");
  }
}

/* ============================================
   CHIUDI EDITOR
============================================ */
function closeEditor() {
  document.getElementById("noteEditor").style.display = "none";
  currentNoteId = null;
}

/* ============================================
   EVENTI
============================================ */
document.getElementById("addNoteBtn").onclick = () => openEditor();
document.getElementById("cancelBtn").onclick = closeEditor;
document.getElementById("saveBtn").onclick = saveNote;
document.getElementById("deleteNoteBtn").onclick = deleteNote;

/* ============================================
   CATEGORIE
============================================ */
document.querySelectorAll(".cat").forEach(btn => {
  btn.onclick = () => {
    const cat = btn.dataset.cat;
    showNotes(cat);
  };
});

/* ============================================
   AVVIO APP
============================================ */
notes = loadNotes();
autoRestore(); // nuovo
showNotes();
</script>
<script>
/* ============================================
   LINGUE (uguale al tuo originale)
============================================ */
const LANG = {
  de: {
    appTitle: "Notizen",
    newNote: "Neue Notiz",
    editNote: "Notiz bearbeiten",
    cancel: "Abbrechen",
    save: "Speichern",
    chooseCategory: "Kategorie w√§hlen",
    categories: {
      favorite: "Favoriten",
      alle: "Alle",
      arbeit: "Arbeit",
      einkauf: "Einkauf",
      zuhause: "Zuhause",
      ideen: "Ideen",
      personlich: "Pers√∂nlich"
    },
    backup: {
      title: "Sicherung",
      autoBackup: "Backup automatisch",
      manualBackup: "Backup manuell",
      autoRestore: "Wiederherstellung automatisch",
      manualRestore: "Wiederherstellung manuell",
      close: "Schliessen"
    },
    msg: {
      favAdd: "Zu Favoriten hinzugef√ºgt",
      favRemove: "Aus Favoriten entfernt",
      deleted: "Notiz gel√∂scht"
    }
  },

  it: {
    appTitle: "Note",
    newNote: "Nuova nota",
    editNote: "Modifica nota",
    cancel: "Annulla",
    save: "Salva",
    chooseCategory: "Scegli categoria",
    categories: {
      favorite: "Preferiti",
      alle: "Tutte",
      arbeit: "Lavoro",
      einkauf: "Spesa",
      zuhause: "Casa",
      ideen: "Idee",
      personlich: "Personale"
    },
    backup: {
      title: "Backup",
      autoBackup: "Backup automatico",
      manualBackup: "Backup manuale",
      autoRestore: "Ripristino automatico",
      manualRestore: "Ripristino manuale",
      close: "Chiudi"
    },
    msg: {
      favAdd: "Aggiunto ai preferiti",
      favRemove: "Rimosso dai preferiti",
      deleted: "Nota eliminata"
    }
  },

  en: {
    appTitle: "Notes",
    newNote: "New Note",
    editNote: "Edit Note",
    cancel: "Cancel",
    save: "Save",
    chooseCategory: "Choose category",
    categories: {
      favorite: "Favorites",
      alle: "All",
      arbeit: "Work",
      einkauf: "Shopping",
      zuhause: "Home",
      ideen: "Ideas",
      personlich: "Personal"
    },
    backup: {
      title: "Backup",
      autoBackup: "Automatic Backup",
      manualBackup: "Manual Backup",
      autoRestore: "Automatic Restore",
      manualRestore: "Manual Restore",
      close: "Close"
    },
    msg: {
      favAdd: "Added to favorites",
      favRemove: "Removed from favorites",
      deleted: "Note deleted"
    }
  },

  es: {
    appTitle: "Notas",
    newNote: "Nueva nota",
    editNote: "Editar nota",
    cancel: "Cancelar",
    save: "Guardar",
    chooseCategory: "Elegir categor√≠a",
    categories: {
      favorite: "Favoritos",
      alle: "Todas",
      arbeit: "Trabajo",
      einkauf: "Compras",
      zuhause: "Casa",
      ideen: "Ideas",
      personlich: "Personal"
    },
    backup: {
      title: "Copia de seguridad",
      autoBackup: "Copia autom√°tica",
      manualBackup: "Copia manual",
      autoRestore: "Restauraci√≥n autom√°tica",
      manualRestore: "Restauraci√≥n manual",
      close: "Cerrar"
    },
    msg: {
      favAdd: "A√±adido a favoritos",
      favRemove: "Eliminado de favoritos",
      deleted: "Nota eliminada"
    }
  }
};

/* ============================================
   APPLICA LINGUA
============================================ */
function applyLanguage(lang) {
  currentLang = lang;
  const L = LANG[lang];

  document.getElementById("appTitle").textContent = L.appTitle;
  document.getElementById("cancelBtn").textContent = L.cancel;
  document.getElementById("saveBtn").textContent = L.save;
  document.getElementById("categorySheetTitle").textContent = L.chooseCategory;

  document.querySelectorAll(".cat").forEach(btn => {
    const key = btn.dataset.cat;
    btn.querySelector(".catLabel").textContent = L.categories[key];
  });

  document.querySelector("#backupBox h2").textContent = L.backup.title;
  document.querySelector("#autoBackupBtn span").textContent = L.backup.autoBackup;
  document.querySelector("#manualBackupBtn span").textContent = L.backup.manualBackup;
  document.querySelector("#autoRestoreBtn span").textContent = L.backup.autoRestore;
  document.querySelector("#manualRestoreBtn span").textContent = L.backup.manualRestore;
  document.querySelector("#backupCloseBtn span").textContent = L.backup.close;

  localStorage.setItem("lang", lang);
  showNotes();
}

/* ============================================
   POPUP LINGUA
============================================ */
document.getElementById("langBtn").onclick = () => {
  document.getElementById("langPopup").style.display = "flex";
};

document.querySelectorAll(".langChoice").forEach(btn => {
  btn.onclick = () => {
    applyLanguage(btn.dataset.lang);
    document.getElementById("langPopup").style.display = "none";
  };
});

document.getElementById("langPopup").onclick = e => {
  if (e.target.id === "langPopup") {
    document.getElementById("langPopup").style.display = "none";
  }
};

/* ============================================
   POPUP BACKUP
============================================ */
document.getElementById("backupBtn").onclick = () => {
  document.getElementById("backupPopup").style.display = "flex";
};

document.getElementById("backupCloseBtn").onclick = () => {
  document.getElementById("backupPopup").style.display = "none";
};

document.getElementById("backupPopup").onclick = e => {
  if (e.target.id === "backupPopup") {
    document.getElementById("backupPopup").style.display = "none";
  }
};

/* ============================================
   BACKUP MANUALE
============================================ */
document.getElementById("manualBackupBtn").onclick = () => {
  localStorage.setItem("notes_backup_manual", JSON.stringify(notes));
  showBanner("Backup salvato");
};

/* ============================================
   RIPRISTINO MANUALE
============================================ */
document.getElementById("manualRestoreBtn").onclick = () => {
  const saved = localStorage.getItem("notes_backup_manual");
  if (saved) {
    notes = JSON.parse(saved);
    saveNotes();
    showNotes();
    showBanner("Backup ripristinato");
  }
};

/* ============================================
   BACKUP AUTOMATICO (toggle)
============================================ */
document.getElementById("autoBackupBtn").onclick = () => {
  showBanner("Backup automatico attivo");
};

/* ============================================
   RIPRISTINO AUTOMATICO (toggle)
============================================ */
document.getElementById("autoRestoreBtn").onclick = () => {
  autoRestore();
  showNotes();
  showBanner("Ripristino automatico eseguito");
};

/* ============================================
   AVVIO APP
============================================ */
applyLanguage(currentLang);
notes = loadNotes();
autoRestore();
showNotes();
</script>
